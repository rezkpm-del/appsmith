{
  "gitSyncId": "694ebec5a56d53482b864ab0_aac0897d-cd30-4bfd-84c7-410c05013c63",
  "id": "Facturacion_Odoo_KPI_Query",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n  -- 1. TOTAL DINERO\n  SUM(total) as total_ventas,\n\n  -- 2. TOTAL BULTOS (Cajas cerradas)\n  SUM(cantidad) as total_bultos,\n\n  -- 3. TOTAL UNIDADES REALES (Detecta \"x 12\", \"x 6\", etc. y multiplica)\n  SUM(\n    cantidad * COALESCE(SUBSTRING(producto FROM '[xX]\\s*([0-9]+)')::INTEGER, 1)\n  ) as total_unidades\n\nFROM public.ordenes_compras_odoo\n\nWHERE\n  -- A. FILTRO FECHA DESDE\n  ( {{ !FechaDesde.formattedDate }} OR fecha >= TO_DATE({{ FechaDesde.formattedDate }}, 'DD-MM-YYYY') )\n  AND\n  \n  -- B. FILTRO FECHA HASTA\n  ( {{ !FechaHasta.formattedDate }} OR fecha <= TO_DATE({{ FechaHasta.formattedDate }}, 'DD-MM-YYYY') )\n  AND\n  \n  -- C. FILTRO CLIENTE (MULTIPLE)\n  ( {{ SelectCliente.selectedOptionValues.length === 0 }} OR cliente = ANY ({{ SelectCliente.selectedOptionValues }}) )\n  AND\n  \n  -- D. FILTRO PRODUCTO (MULTIPLE)\n  ( {{ SelectProducto.selectedOptionValues.length === 0 }} OR producto = ANY ({{ SelectProducto.selectedOptionValues }}) )",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 30000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Untitled datasource 1",
      "isAutoGenerated": false,
      "name": "Untitled datasource 1",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "KPI_Query",
    "pageId": "Facturacion_Odoo",
    "runBehaviour": "AUTOMATIC",
    "userSetOnLoad": false
  }
}