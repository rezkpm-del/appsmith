SELECT 
    -- Cantidad de ventas
    COUNT(*) as cantidad_operaciones,
    
    -- Total con IVA (Nombre corregido)
    SUM(Factura_MontoTotal) as venta_total_con_iva,
    
    -- Total sin IVA (Calculado: Total - IVA - Otros Impuestos)
    SUM(Factura_MontoTotal - Factura_MontoIVA - Factura_MontoOtrosImpuestos) as venta_sin_iva,
    
    -- Total IVA (Nombre corregido)
    SUM(Factura_MontoIVA) as total_iva
    
FROM ventas

WHERE 
    -- 1. Filtro Sucursal
    IdSucursal = {{ SelectSucursal.selectedOptionValue }}
    
    -- 2. Filtro Fechas
    -- (Verifica si la columna de fecha en 'ventas' se llama 'Fecha' o 'FechaComprobante'.
    -- Si te da error de 'Unknown column FechaComprobante', cÃ¡mbialo a 'Fecha')
    AND FechaComprobante >= '{{ FechaDesde.formattedDate }}'
    AND FechaComprobante <= '{{ FechaHasta.formattedDate }}'
    
    -- 3. Filtro Tipo Comprobante (Opcional)
    AND (
        {{ !SelectComprobante.selectedOptionValue }} 
        OR ComprobanteFiscal = {{ SelectComprobante.selectedOptionValue }}
    )